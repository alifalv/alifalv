
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1>案源列表</h1>
          </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
           
				  <form class="form-inline">
					   <!-- 不明确类型 -->
					   <label class="my-1 mr-2">类型</label>
					   <select class="form-control my-1 mr-sm-2" id="type">
						<option value="0" selected>全部</option>
			            <option value="1">立案问题</option>
			            <option value="2">刑事侦查</option>
			            <option value="3">刑事诉讼</option>
			            <option value="4">监所问题</option>
			            <option value="5">行政处罚</option>
			            <option value="6">行政审批</option>
			            <option value="7">行政诉讼</option>
			            <option value="8">婚姻家庭</option>
			            <option value="9">交通事故</option>
			            <option value="10">民间借贷</option>
			            <option value="11">劳动争议</option>
			            <option value="12">公司纠纷</option>
			            <option value="13">房地产</option>
			            <option value="14">担保纠纷</option>
			            <option value="15">治安案件</option>
			            <option value="16">合同纠纷</option>
			            <option value="17">侵权责任</option>
			            <option value="18">知识产权</option>
			            <option value="19">税务问题</option>
			            <option value="20">拆迁争议</option>
			            <option value="21">法医鉴定</option>
			            <option value="22">其他鉴定</option>
			            <option value="23">民事执行</option>
			            <option value="24">其他民商事</option>
					  </select>

					  <div class="form-group">
						<label >地区</label>
						<select class="form-control my-1 mr-sm-2" id="select_province" onchange="changeProvince()">
						  <option value="">请选择省份</option><option value="1">北京市</option><option value="2">天津市</option><option value="3">上海市</option><option value="4">重庆市</option><option value="5">河北省</option>
						  <option value="6">山西省</option><option value="7">台湾省</option><option value="8">辽宁省</option><option value="9">吉林省</option><option value="10">黑龙江省</option>
						  <option value="11">江苏省</option><option value="12">浙江省</option><option value="13">安徽省</option><option value="14">福建省</option><option value="15">江西省</option>
						  <option value="16">山东省</option><option value="17">河南省</option><option value="18">湖北省</option><option value="19">湖南省</option><option value="20">广东省</option>
						  <option value="21">甘肃省</option><option value="22">四川省</option><option value="23">贵州省</option><option value="24">海南省</option><option value="25">云南省</option>
						  <option value="26">青海省</option><option value="27">陕西省</option><option value="28">广西壮族自治区</option><option value="29">西藏自治区</option><option value="30">宁夏回族自治区</option>
						  <option value="31">新疆维吾尔自治区</option><option value="32">内蒙古自治区</option><option value="33">澳门特别行政区</option><option value="34">香港特别行政区</option>
						</select>
						  <select class="form-control my-1 mr-sm-2" id="select_city">
							
						  </select>
					  </div>

					  <!-- <div  style="display:inline;text-align: center; margin-left:20px;text-align:center;margin:0 auto;" >-->
					  <div class="form-group">
						<!-- <div style="display:inline;width:100px;font-size:16px;color:#999999;margin-left:20px;">时间</div>-->
						<label class="control-label" for="starttime">时间:</label>
						<div  style="display:inline;margin-left:10px; margin-right:10px;">
							<input type="text" style="border:1px solid #ccc;"  value="" id="starttime" readonly>
							到
							<input type="text" style="border:1px solid #ccc;"  value="" id="endtime" readonly>
						</div>
					  </div>

					  <div class="form-group">
						<input type="text" id="titleAndpeople" class="form-control mx-sm-3" aria-describedby="passwordHelpInline" placeholder="标题、发布人">
					  </div>

					  <div class="form-group" >
						  <button type="button" class="btn btn-success" onclick="search()">查询</button>
						  <button type="button" class="btn btn-success" style="margin-left:10px;" onclick="reset()">重置</button>
					  </div>
				   </form>

            </div>
            <!-- /.card-header -->
            <div class="card-body">
              <table id="sourceDT" class="table table-bordered table-hover">
                <thead>
					<tr>
					  <th>编号</th>
					  <th>标题</th>
					  <th>委托费报价(元)</th>
					  <th>类型</th>
					  <th>地区</th>
					  <th>发布人</th>
					  <th>添加时间</th>
					  <th>状态</th>
					  <th>操作</th>
					</tr>
                </thead>
              
              </table>
            </div>
            <!-- /.card-body -->
          </div>
          <!-- /.card -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"  aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
		  <div class="modal-header">
			<h5 class="modal-title">审核</h5>
			<button type="button" class="close" data-dismiss="modal" aria-label="Close">
			  <span aria-hidden="true">&times;</span>
			</button>
		  </div>
		  <div class="modal-body">
			<div class="form-check form-check-inline">
				  <label class="form-check-label mx-sm-3" for="inlineRadio1">审核结果</label>
				  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="option1">
				  <label class="form-check-label" for="inlineRadio1">通过</label>
				</div>
				<div class="form-check form-check-inline">
				  <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="option2">
				  <label class="form-check-label" for="inlineRadio2">不通过</label>
				</div>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			<button type="button" class="btn btn-primary">Save changes</button>
		  </div>
		</div>
	  </div>
  </div>

	<div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="mySmallModalLabel">
		<div class="modal-dialog modal-dialog-centered modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<h6 class="modal-title" >删除提醒</h6>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<ul class="nav justify-content-center">
						<li class="nav-item">
							<span class="nav-link">确认删除?</span>
						</li>
					</ul>
					<input type="text" id="id_del" style="display:none;">
        		<input type="text" id="id_userId" style="display:none;"/>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
					<button type="button" class="btn btn-primary" onclick="delResult()">确认删除</button>
				</div>
			</div>
		</div>
	</div>
<script type="application/javascript" charset="utf-8">
	//时间控件
	var start = {
		format : 'YYYY-MM-DD hh:mm:ss',
		//minDate : '2016-01-01', //设定最小日期为当前日期
		//isinitVal:true,
		//maxDate : $.nowDate(0), //最大日期
		choosefun : function(elem, datas) {
			end.minDate = datas; //开始日选好后，重置结束日的最小日期
		}
	};
	var end = {
		format : 'YYYY-MM-DD hh:mm:ss',
		//minDate : $.nowDate(0), //设定最小日期为当前日期
		//isinitVal:true,
		//maxDate : $.nowDate(0), //最大日期
		choosefun : function(elem, datas) {
			start.maxDate = datas; //将结束日的初始值设定为开始日的最大日期
		}
	};
	var intime = {
		format : 'YYYY-MM-DD hh:mm:ss',
		//minDate : '2016-01-01', //设定最小日期为当前日期
		//isinitVal:true,
		//maxDate : $.nowDate(0), //最大日期
		choosefun : function(elem, datas) {
			end.minDate = datas; //开始日选好后，重置结束日的最小日期
			choiceInTime();
		}
	};
	var addRecordTime = {
		format : 'YYYY-MM-DD hh:mm:ss',
		//minDate : '2016-01-01', //设定最小日期为当前日期
		//isinitVal:true,
		//maxDate : $.nowDate(0), //最大日期
		choosefun : function(elem, datas) {
			end.minDate = datas; //开始日选好后，重置结束日的最小日期
			choiceInTime();
		}
	};
	$("#starttime").jeDate(start);
	$("#endtime").jeDate(end);
	$("#outstarttime").jeDate(start);
	$("#outendtime").jeDate(end);
	$("#intime").jeDate(intime);
	$("#addRecordTime").jeDate(addRecordTime);
	//时间控件 结束
	
	//查找按钮
	function search(){
		sourceDT.ajax.reload();
	} 
    function reload(){
		var table = $('#sourceDT').DataTable();
		table.draw(false);  //  重新绘制维护当前分页位置的表格。
    }
	
	//重置按钮
	function reset(){
		$("#titleAndpeople").val("");
		$("#area").val("");
		$("#type").val("0");
	} 

	//删除   /case/depute/remove/{caseId}
	function delMsg(id,userId){
		$("#id_del").val(id);
        $("#id_userId").val(userId);
		$("#mySmallModalLabel").modal("show");
	}
	
	//删除按钮
	function delResult(){
		var id = $("#id_del").val();
		$("#mySmallModalLabel").modal("hide");
		var parameter = new FormData();
        Yajax({
            type:'GET',
            url:requestUrl+'case/depute/remove/'+id,
            data:parameter,
            processData : false, // 告诉jQuery不要去处理发送的数据
            contentType : false, // 告诉jQuery不要去设置Content-Type请求头
            success : function(data) {
                console.log(data);
                if(data.code==1){
                alert("删除成功");
                sendMessage();
                reload();
                }
            },
            fail:function (data) {
                console.log(data);
                alert("删除失败");
            }
        });
	}
	
	//发站内消息
	function sendMessage(){
        Yajax({
            type:'POST',
            url:requestUrl+"message/messageSend",
            data:{
	            	userId:$('#id_userId').val(),
	            	messageContent:"案件内容违规已删除",
	            	businessType:1,
	            	businessId:$("#id_del").val(),
	            	messageType:"案源管理"
            },
            success : function(data) {
                console.log(data);
            },
            fail:function (data) {
                console.log(data);
            }
        });
	}
</script>

<script type="application/javascript" charset="utf-8">
var sourceDT;
$(document).ready(function(){
	sourceDT=$('#sourceDT').DataTable( {
        //-------------固定配置，不用改--------------
        "ordering": false,
        "serverSide": true,
        "pagingType":"numbers",
        "searching": false,
        "processing": true,
        "pageLength": 5,
        "lengthChange": false,
        "language": {
            "sProcessing": "处理中...",
            "sLengthMenu": "显示 _MENU_ 项结果",
            "sZeroRecords": "没有匹配结果",
            "sInfo": "显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",
            "sInfoEmpty": "显示第 0 至 0 项结果，共 0 项",
            "sInfoFiltered": "(由 _MAX_ 项结果过滤)",
            "sInfoPostFix": "",
            "sSearch": "搜索:",
            "sEmptyTable": "表中数据为空",
            "sLoadingRecords": "载入中...",
            "sInfoThousands": ",",
            "oPaginate": {
                "sFirst": "首页",
                "sPrevious": "上页",
                "sNext": "下页",
                "sLast": "末页"
            },
            "oAria": {
                "sSortAscending": ": 以升序排列此列",
                "sSortDescending": ": 以降序排列此列"
            }
        },
        //----------------------------------------------
        ajax:{
            url:requestUrl+'case/depute/list',
            type:'POST',
            data:{
                "start": 0,
                "length": 5
            }
        },
			"aoColumns": [
				//编号
				{ "data":"caseId",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.caseId  != null && full.caseId  !=""){
							return full.caseId ;
						}
						return "";
					}
				},		
				//标题
				{ "data":"caseTitle",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.caseTitle != null && full.caseTitle !=""){
							return '<a href="#" onclick="RedirectToPC(\'casebiddinginfo.html?caseId='+full.caseId+'\')">'+full.caseTitle+'</a>';
						}
						return "";
					}
				},
				//委托费报价(元)
				{ "data":"offerMoney ",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.offerMoney  != null && full.offerMoney  !=""){
							return full.offerMoney ;
						}
						return "";
					}
				},
				//类型
				{ "data":"caseTypeDescription",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.caseTypeDescription != null && full.caseTypeDescription!=""){
							return full.caseTypeDescription;
						}
						return "";
					}
				},
				//地区
				{ "data":"provinceDescription",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.provinceDescription != null && full.provinceDescription!=""){
							return full.provinceDescription+full.cityDescription;
						}
						return "";
					}
				},
				//发布人
				{ "data":"userName",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.userName != null && full.userName!=""){
							return full.userName;
						}
						return "";
					}
				},
				//添加时间
				{ "data":"deputeTime",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.deputeTime != null && full.deputeTime!=""){
							return full.deputeTime;
						}
						return "";
					}
				},
				//状态
				{ "data":"isPayDescription",
					"visible": true,
					"mRender":function(data,type,full){
					   if(full.isPayDescription != null && full.isPayDescription!=""){
							return full.isPayDescription;
						}
						return "";
					}
				},
                //操作
                { "data":null,
                    "visible": true,
                    "render":function(data,type,full){
                        return '<input type="button" class="btn btn-success" value="详情" onclick="RedirectToPC(\'casebiddinginfo.html?caseId='+full.caseId+'\')"/>&nbsp;'+
                        '<input type="button" class="btn btn-success" value="删除" onclick="delMsg(\''+full.caseId+'\',\''+full.userId+'\')"/>' ;
                    }
                }
			],
			"fnServerData": function ( sSource, aoData, fnCallback ) {
				aoData.push({'name':'deputeTimeStart','value':$('#starttime').val()});
				aoData.push({'name':'deputeTimeEnd','value':$('#endtime').val()});
				aoData.push({'name':'province','value':$('#select_province').val()});
				aoData.push({'name':'city','value':$('#select_city').val()});
				aoData.push({'name':'content','value':$('#titleAndpeople').val()});
				aoData.push({'name':'caseType','value':$('#type').val()});
			    Yajax( {
					"dataType": 'json',
					"type": "POST",
					"url": requestUrl+'case/depute/list',
					"data": aoData,
					"success": fnCallback
				});
			},
		} );
	//}
});

//根据省份获取城市信息
function changeProvince(){
	var provinceId = $("#select_province").val();
	if(provinceId==''){
		$('#select_city').empty();
	}else{
		Yajax({
		    type:'POST',
		    url:requestUrl+"address/cityListByProvince/"+provinceId,
	      async: false,
		    success : function(data) {
		        console.log(data);
		        if(data.code==1){
		        		$('#select_city').empty();
		            for(var i in data.data){
		            	 	var selecthtml = '<option value="'+data.data[i].cityId+'">'+data.data[i].cityName+'</option>';
		            	 	$('#select_city').append(selecthtml);
		            }
		        }
		    },
		    fail:function (data) {
		        console.log(data);
		    }
		});
	}
}
</script>
